reset_DNS() {
    check_connection() {
        ping -c 1 8.8.8.8 >/dev/null
    }
    check_dns() {
        ping -c 1 google.com >/dev/null
    }
    echo "# Checking and updating /etc/resolv.conf" | tee -a "$output_file"
    echo $key | sudo -S mv /etc/resolv.conf /etc/resolv.conf.bak
    echo "nameserver 127.0.0.53" | sudo tee /etc/resolv.conf > /dev/null
    echo "nameserver 127.3.2.1" | sudo tee -a /etc/resolv.conf > /dev/null
    printf "\nDNS nameservers updated.\n"
    echo $key | sudo -S systemctl restart systemd-resolved
    while ! systemctl is-active --quiet systemd-resolved; do
        echo "Waiting for systemd-resolved to restart..." | tee -a "$output_file"
        sleep 1
    done
    echo "systemd-resolved restarted successfully." | tee -a "$output_file"

    max_retries=5
    retry_count=0

    while [[ $retry_count -lt $max_retries ]]; do
        if check_connection; then
            echo "Internet connection is working." | tee -a "$output_file"
            if ! check_dns; then
                echo "The internet is working, but DNS is not working. Please check your resolv.conf file" | tee -a "$output_file"
                ((retry_count++))
            else
                break
            fi
        else
            echo "Internet connection is not working. Please check your network." | tee -a "$output_file"
            ((retry_count++))
        fi
    done
    if [[ $retry_count -eq $max_retries ]]; then
        echo "Maximum retries reached. Exiting." | tee -a "$output_file"
    fi
    echo $key | sudo -S sleep 1
    sudo -k
}